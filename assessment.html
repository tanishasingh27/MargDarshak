<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Margdarshak Quiz</title>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

  <!-- Embedded CSS -->
  <style>
      * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
    body { background-color: #f8f9fa; color: #333; }
   /* Navbar */
.navbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 10%;
  background: rgba(255, 255, 255, 0.822);
  backdrop-filter: blur(12px);
  border-radius: 0 0 16px 16px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  position: sticky;
  top: 0;
  z-index: 1000;
}

/* Logo */
.navbar .logo {
  font-size: 24px;
  font-weight: 800;
  color: #007fe8;
  letter-spacing: 1px;
  transition: transform 0.3s;
}
.navbar .logo:hover {
  transform: scale(1.08);
}

/* Navbar Menu */
.navbar ul {
  list-style: none;
  display: flex;
  gap: 25px;
  align-items: center;
}

/* Links */
.navbar ul li a {
  text-decoration: none;
  color: #333;
  font-weight: 600;
  font-size: 15px;
  position: relative;
  transition: color 0.3s;
}

/* Underline animation */
.navbar ul li a::after {
  content: "";
  position: absolute;
  width: 0%;
  height: 2px;
  left: 0;
  bottom: -6px;
  background: #007bff;
  transition: width 0.3s;
}
.navbar ul li a:hover {
  color: #007bff;
}
.navbar ul li a:hover::after {
  width: 100%;
}

/* Buttons (Profile + Logout) */
.navbar ul li button {
  padding: 8px 18px;
  border: none;
  border-radius: 20px;
  cursor: pointer;
  font-weight: 600;
  font-size: 14px;
  transition: all 0.3s;
}

/* Profile button */
.navbar ul li .profile-btn {
  background: #007bff;
  color: #fff;
}
.navbar ul li .profile-btn:hover {
  background: #0056b3;
  transform: translateY(-2px);
}

    .quiz-container { max-width: 800px; margin: 40px auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .quiz-title { font-size: 24px; margin-bottom: 10px; color: #2c3e50; }
    .quiz-subtitle { font-size: 16px; color: #777; margin-bottom: 20px; }
    .progress-bar { background: #eee; border-radius: 6px; overflow: hidden; margin-bottom: 8px; }
    .progress { height: 10px; width: 0; background: #27ae60; transition: width 0.3s; }
    .progress-text { font-size: 14px; color: #555; margin-bottom: 20px; }
    .quiz-meta { display: flex; justify-content: space-between; margin-bottom: 20px; font-size: 14px; color: #555; }
    .question-block h3 { font-size: 20px; margin-bottom: 15px; color: #34495e; }
    .options label { display: block; background: #f9f9f9; border: 1px solid #ddd; padding: 12px 15px; margin-bottom: 10px; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
    .options input { margin-right: 10px; } .options label:hover { background: #f1f1f1; }
    .buttons { display: flex; justify-content: space-between; margin-top: 20px; }
    .buttons button { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; }
    .buttons .prev { background: #bdc3c7; color: #fff; } .buttons .next { background: #2980b9; color: #fff; }

    .completion { text-align: center; } .completion h2 { color: #27ae60; font-size: 26px; } .completion p { font-size: 16px; margin-bottom: 20px; }
    #completionBox { text-align: left; background: #f9f9f9; padding: 20px; border-radius: 8px; border: 1px solid #ddd; }
    #completionBox ul { margin: 0; padding: 0; list-style: none; } #completionBox li { margin: 8px 0; font-size: 15px; }
    .completeBtns { margin-top: 25px; display: flex; justify-content: center; gap: 20px; }
    .result-btn { padding: 12px 25px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; display: inline-block; }
    .result-btn.primary { background: #27ae60; color: #fff; } .result-btn.secondary { background: #95a5a6; color: #fff; }

    /* small status text */
    #saveStatus { margin-top: 12px; color: #444; font-size: 15px; }
  </style>
</head>
<body>
 <!-- üîπ Navbar -->
  <nav class="navbar">
    <div class="logo">MargDarshak</div>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="assessment.html">Assessment</a></li>
      <li><a href="career.html">Career Guide</a></li>
      <li><a href="college.html">College</a></li>
      <li><a href="notification.html">Updates</a></li>
      <li><a id="profileBtn" href="profile.html">Profile</a></li>
      <li><button id="logoutBtn">Logout</button></li>
    </ul>
  </nav>
  <!-- üîπ Quiz Screen -->
  <div class="quiz-container" id="quizScreen">
    <h2 class="quiz-title" id="quizTitle"></h2>
    <div class="progress-bar"><div class="progress" id="progress"></div></div>
    <p class="progress-text" id="progressText"></p>
    <div class="quiz-meta">
      <span class="timer" id="timer">‚è± 15:00</span>
      <span class="qnum" id="qnum"></span>
    </div>
    <div class="question-block">
      <h3 id="question"></h3>
      <div class="options" id="options"></div>
    </div>
    <div class="buttons">
      <button class="prev" id="prevBtn">‚Üê Previous</button>
      <button class="next" id="nextBtn">Next ‚Üí</button>
    </div>
  </div>

  <!-- üîπ Completion Screen -->
  <div class="quiz-container completion" id="completionScreen" style="display:none;">
    <h2>Assessment Complete! üéâ</h2>
    <p>Thank you for completing the career assessment. We're analyzing your responses to provide personalized recommendations.</p>
    <div id="completionBox">
      <h3>What happens next?</h3>
      <ul>
        <li><b>üß† AI Analysis:</b> Your responses are analyzed for your strengths and personality.</li>
        <li><b>üéØ Career Matching:</b> We'll match you with careers that align with your profile.</li>
        <li><b>üìÑ Personalized Report:</b> You'll get a detailed report with recommendations.</li>
      </ul>
    </div>
    <div class="completeBtns">
      <!-- initially hidden; will be shown after save -->
      <button class="result-btn primary" id="viewResultsBtn" style="display:none;">View My Results</button>
      <button class="result-btn secondary" onclick="location.href='index.html'">Back to Home</button>
    </div>
    <div id="saveStatus" aria-live="polite"></div>
  </div>

<script>
// -------------------- YOUR QUESTIONS & SCORING (unchanged) --------------------
/* (I kept all your question arrays and scoring exactly as in your previous version) */

const questions = [
  // ... (same questions as your original code) ...
  // I'll paste them programmatically here to keep message short when copying:
  // --- BEGIN QUESTIONS (copy exactly from your original to keep unchanged) ---
  {
    type: "personality",
    category: "Personality",
    text: "When working in a group, you usually prefer to:",
    options: [
      "Lead and organize the team",
      "Support others with ideas",
      "Work independently",
      "Observe and analyze quietly"
    ]
  },
  {
    type: "personality",
    category: "Personality",
    text: "How do you usually handle stress?",
    options: [
      "By staying calm and thinking logically",
      "By discussing it with friends/family",
      "By distracting yourself with creative activities",
      "By avoiding or delaying decisions"
    ]
  },
  {
    type: "objective",
    category: "Logical & Analytical",
    text: "If all roses are flowers, and some flowers fade quickly, then:",
    options: ["All roses fade quickly","Some roses may fade quickly","No roses fade quickly","Cannot be determined"],
    correct: 1
  },
  {
    type: "objective",
    category: "Logical & Analytical",
    text: "Identify the missing number: 2, 6, 12, 20, ?",
    options: ["28","30","32","34"],
    correct: 0
  },
  {
    type: "objective",
    category: "Numerical & Quantitative",
    text: "A train runs at 60 km/h. How far will it travel in 2 hours 30 minutes?",
    options: ["120 km","130 km","140 km","150 km"],
    correct: 3
  },
  {
    type: "objective",
    category: "Numerical & Quantitative",
    text: "If the cost price of 12 pens is equal to the selling price of 10 pens, then the profit % is:",
    options: ["15%","18%","20%","25%"],
    correct: 3
  },
  {
    type: "objective",
    category: "Verbal & Communication",
    text: "Choose the word most similar in meaning to Meticulous:",
    options: ["Careless","Precise","Confused","Ordinary"],
    correct: 1
  },
  {
    type: "personality",
    category: "Verbal & Communication",
    text: "You are asked to give a speech to a group of strangers. How do you feel?",
    options: ["Confident and excited","Nervous but willing","Anxious and hesitant","Prefer to avoid"]
  },
  {
    type: "personality",
    category: "Creative Thinking",
    text: "You are given a brick. Which of these is the most creative use?",
    options: ["Build a wall","Use as a paperweight","Design a piece of art","Use it for door support"]
  },
  {
    type: "objective",
    category: "Creative Thinking",
    text: "Which pattern comes next? ‚ñ† ‚ñ≤ ‚ñ† ‚ñ≤ ‚ñ† ?",
    options: ["‚ñ≤","‚ñ†","‚óè","‚ô¶"],
    correct: 0
  },
  {
    type: "personality",
    category: "Situational Judgment",
    text: "Your teammate makes a mistake in a group project. What do you do?",
    options: ["Report it to the teacher/boss immediately","Correct it silently","Discuss it politely with them and help fix it","Blame the whole group"]
  },
  {
    type: "personality",
    category: "Situational Judgment",
    text: "You are given two tasks with the same deadline, but both are time-consuming. What will you do?",
    options: ["Do whichever you like first","Ask for deadline extension","Prioritize and manage both step by step","Avoid one task completely"]
  },
  {
    type: "personality",
    category: "Interest Mapping",
    text: "Which activity excites you the most?",
    options: ["Solving puzzles","Writing stories","Designing posters","Leading a group discussion"]
  },
  {
    type: "personality",
    category: "Interest Mapping",
    text: "Which of these careers appeals to you more?",
    options: ["Data Scientist","Journalist","Entrepreneur","Graphic Designer"]
  },
  {
    type: "objective",
    category: "Logical & Analytical",
    text: "Find the odd one out:",
    options: ["Mango","Apple","Potato","Orange"],
    correct: 2
  },
  {
    type: "objective",
    category: "Logical & Analytical",
    text: "If \"EARTH\" is coded as \"FBSUI\", then \"MOON\" is coded as:",
    options: ["NPPM","NPPO","NQOO","NOOP"],
    correct: 0
  },
  {
    type: "personality",
    category: "Verbal & Communication",
    text: "You are asked to explain a topic to your classmates. You would:",
    options: ["Use simple words and examples","Use technical terms to sound smart","Avoid it if possible","Read directly from notes"]
  },
  {
    type: "objective",
    category: "Numerical & Quantitative",
    text: "A box contains 4 red balls and 6 blue balls. Probability of drawing a red ball?",
    options: ["1/2","2/5","1/3","3/5"],
    correct: 1
  },
  {
    type: "personality",
    category: "Creative Thinking",
    text: "You are given 24 hours to create something new. You will:",
    options: ["Make a mini project (coding/science)","Write/perform something creative","Organize an event/game","Design artwork"]
  },
  {
    type: "personality",
    category: "Situational Judgment",
    text: "If you see two classmates fighting, you will:",
    options: ["Ignore them","Inform the teacher","Try to calm them down","Support one side"]
  }
  // --- END QUESTIONS ---
];

const scores_personality = [
  [5,4,3,2],
  [5,4,4,2],
  [0,0,0,0],
  [0,0,0,0],
  [0,0,0,0],
  [0,0,0,0],
  [0,0,0,0],
  [0,0,0,0],
  [5,4,2,1],
  [5,3,4,2],
  [0,0,0,0],
  [5,3,4,2],
  [2,3,5,1],
  [5,4,3,2],
  [5,4,3,2],
  [0,0,0,0],
  [0,0,0,0],
  [5,4,2,3],
  [0,0,0,0],
  [5,4,3,2],
  [2,4,5,1]
];

const categoryRecommendations = {
  "Logical & Analytical": ["Engineering", "Computer Science", "Data Science"],
  "Numerical & Quantitative": ["Finance", "Economics", "Statistics"],
  "Verbal & Communication": ["Journalism", "Law", "Public Relations"],
  "Creative Thinking": ["Design", "Fine Arts", "Marketing"],
  "Personality": ["Psychology", "Sociology", "Management"],
  "Situational Judgment": ["HR", "Business Management", "Civil Services"],
  "Interest Mapping": ["Specialized, based on top interest"]
};

let current = 0;
let selectedAnswers = new Array(questions.length).fill(null);

const quizTitle = document.getElementById("quizTitle");
const questionEl = document.getElementById("question");
const qnumEl = document.getElementById("qnum");
const optionsEl = document.getElementById("options");
const progressEl = document.getElementById("progress");
const progressText = document.getElementById("progressText");

function loadQuestion() {
  const q = questions[current];
  quizTitle.textContent = q.category;
  questionEl.textContent = q.text;
  qnumEl.textContent = `Question ${current + 1} of ${questions.length}`;
  optionsEl.innerHTML = "";
  q.options.forEach((opt, i) => {
    const lbl = document.createElement("label");
    lbl.innerHTML = `<input type="radio" name="option" value="${i}"> ${opt}`;
    if (selectedAnswers[current] === i) {
      lbl.querySelector("input").checked = true;
    }
    lbl.addEventListener("click", () => {
      selectedAnswers[current] = i;
      updateProgress();
    });
    optionsEl.appendChild(lbl);
  });
  document.getElementById("prevBtn").disabled = current === 0;
  document.getElementById("nextBtn").textContent = current === questions.length - 1 ? "Finish" : "Next ‚Üí";
  updateProgress();
}
function updateProgress() {
  const answered = selectedAnswers.filter(a => a !== null).length;
  const pct = (answered / questions.length) * 100;
  progressEl.style.width = pct + "%";
  progressText.textContent = `Overall Progress: ${answered}/${questions.length} questions answered`;
}
document.getElementById("prevBtn").addEventListener("click", () => {
  if (current > 0) {
    current--;
    loadQuestion();
  }
});
document.getElementById("nextBtn").addEventListener("click", () => {
  if (current < questions.length - 1) {
    current++;
    loadQuestion();
  } else {
    if (selectedAnswers.includes(null)) {
      alert("Please answer all questions.");
      return;
    }
    document.getElementById("quizScreen").style.display = "none";
    document.getElementById("completionScreen").style.display = "block";
    submitQuiz(); // save results but do not redirect
  }
});
// Timer
let time = 15 * 60;
const timerEl = document.getElementById("timer");
function updateTimer() {
  const m = Math.floor(time / 60);
  const s = time % 60;
  timerEl.textContent = `‚è± ${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
  if (time > 0) {
    time--;
  } else {
    alert("Time up!");
  }
}
setInterval(updateTimer, 1000);

// -------------------- FIREBASE + SUBMISSION --------------------
const firebaseConfig = {
  apiKey: "AIzaSyCgb7JhR9ko1YH2gyrPPtFb2ZGqq8IXg6g",
  authDomain: "margdarshak-58c9c.firebaseapp.com",
  projectId: "margdarshak-58c9c",
  storageBucket: "margdarshak-58c9c.appspot.com",
  messagingSenderId: "912493540489",
  appId: "1:912493540489:web:88e299d732a7ad7c6f0258",
  measurementId: "G-BYPBLGPZTY"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
let userID = "temp_user"; // replace with real UID when you add auth

function calculateResults(answers) {
  const categoryScores = {};
  const details = {};

  questions.forEach((q, qIdx) => {
    const cat = q.category;
    const type = q.type;
    if (!(cat in categoryScores)) categoryScores[cat] = 0;
    if (!(cat in details)) details[cat] = [];

    if (type === "objective") {
      if (answers[qIdx] === q.correct) {
        categoryScores[cat] += 5;
        details[cat].push(5);
      } else {
        details[cat].push(0);
      }
    } else if (type === "personality") {
      let score = 3;
      if (scores_personality[qIdx] && scores_personality[qIdx][answers[qIdx]] !== undefined) {
        score = scores_personality[qIdx][answers[qIdx]];
      }
      categoryScores[cat] += score;
      details[cat].push(score);
    }
  });

  let sorted = Object.entries(categoryScores).sort((a,b) => b[1]-a[1]);
  let top1 = sorted.length > 0 ? sorted[0][0] : null;
  let top2 = sorted.length > 1 ? sorted[1][0] : null;
  let recommendedCourses = [];
  if (top1 && categoryRecommendations[top1]) recommendedCourses = recommendedCourses.concat(categoryRecommendations[top1]);
  if (top2 && categoryRecommendations[top2]) recommendedCourses = recommendedCourses.concat(categoryRecommendations[top2]);

  // Interest Mapping tweak (if you want)
  if (categoryScores["Interest Mapping"] && categoryScores["Interest Mapping"] > 0) {
    let cIdx = 13; // index for the career question (0-based)
    const intOptions = ["Data Scientist", "Journalist", "Entrepreneur", "Graphic Designer"];
    if (answers[cIdx] !== null && intOptions[answers[cIdx]]) {
      recommendedCourses.push(intOptions[answers[cIdx]] + " Pathways");
    }
  }

  return { categoryScores, details, recommendedCourses, topCategories: [top1, top2], answers };
}

const viewBtn = document.getElementById("viewResultsBtn");
const saveStatus = document.getElementById("saveStatus");

// make sure button is hidden initially
viewBtn.style.display = 'none';

// If user clicks before save (shouldn't happen normally) - guard
viewBtn.addEventListener('click', () => {
  const id = localStorage.getItem("quizResultID");
  if (!id) {
    alert("Result not yet saved. Please wait a moment.");
    return;
  }
  // redirect to results page
  location.href = 'result.html';
});

function submitQuiz() {
  // disable next/prev to avoid accidental re-tries
  document.getElementById("prevBtn").disabled = true;
  document.getElementById("nextBtn").disabled = true;
  saveStatus.textContent = "Saving results... please wait.";

  const results = calculateResults(selectedAnswers);
  db.collection("quizResults").add({
    userID,
    answers: selectedAnswers,
    ...results,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  })
  .then((docRef) => {
    localStorage.setItem("quizResultID", docRef.id);
    saveStatus.textContent = "Results saved! Click 'View My Results' to see your report.";
    viewBtn.style.display = 'inline-block';
    viewBtn.focus();
  })
  .catch((error) => {
    console.error("Error saving quiz results:", error);
    saveStatus.textContent = "Error saving results. Please try again or contact support.";
    // re-enable next button so user can try again if needed
    document.getElementById("nextBtn").disabled = false;
    document.getElementById("prevBtn").disabled = false;
    alert("Error saving quiz results: " + error);
  });
}

loadQuestion();
</script>

</body>
</html>
